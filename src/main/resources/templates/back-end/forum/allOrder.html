<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>訂單管理後台</title>
  <style>
        .alert-box { margin-top: 20px; }
    </style>
</head>
<body class="p-4">
    <h2>訂單管理</h2>
    <button class="btn btn-secondary mb-3" onclick="location.href='index.html'">回到首頁</button>
    <button class="btn btn-success mb-3 float-end" onclick="location.href='order-add.html'">+ 新增訂單</button>

    <!-- 錯誤訊息顯示 -->
    <div class="alert alert-danger alert-box d-none" id="errorBox">
        <strong>資料載入失敗！</strong> 請檢查後端服務是否啟動及 CORS 設定。<br>
        詳細錯誤：<span id="errorMessage">HTTP 錯誤！狀態: 500</span>
    </div>

    <!-- 訂單資料表格 -->
    <table class="table table-bordered text-center align-middle">
        <thead class="table-primary">
            <tr>
                <th>ID</th>
                <th>會員編號</th>
                <th>優惠票夾代碼</th>
                <th>訂購時間</th>
                <th>訂單狀態</th>
                <th>訂單總額</th>
                <th>使用積分</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="orderTableBody">
            <!-- 資料由 JS 生成 -->
        </tbody>
    </table>

    <label>每頁顯示：
        <select class="form-select d-inline-block w-auto ms-2">
            <option>10 筆</option>
            <option>20 筆</option>
            <option>50 筆</option>
        </select>
    </label>

    <!-- 載入訂單資料的 JS（可對接 API） -->
    <script>
        fetch("/api/orders")
            .then(res => {
                if (!res.ok) throw new Error("HTTP 錯誤！狀態: " + res.status);
                return res.json();
            })
            .then(data => {
                const tbody = document.getElementById("orderTableBody");
                data.forEach(order => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${order.orderNo}</td>
                        <td>${order.memNo}</td>
                        <td>${order.couponWalletNo}</td>
                        <td>${order.orderDatetime}</td>
                        <td>${order.orderStatus}</td>
                        <td>${order.orderTotal}</td>
                        <td>${order.pointUsed}</td>
                        <td>
                            <button class="btn btn-primary btn-sm">編輯</button>
                            <button class="btn btn-danger btn-sm">刪除</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            })
            .catch(err => {
                document.getElementById("errorBox").classList.remove("d-none");
                document.getElementById("errorMessage").textContent = err.message;
            });
    </script>
</body>
</html>